# Production Performance Configuration
# Environment variables for cache, rate limiting, and database optimizations

# ============================================================================
# Redis Configuration
# ============================================================================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_URL=redis://localhost:6379/0
REDIS_MAX_CONNECTIONS=50

# ============================================================================
# Cache Configuration
# ============================================================================
CACHE_ENABLED=true
CACHE_DEFAULT_TTL=3600  # 1 hour in seconds
CACHE_MAX_MEMORY=2gb
CACHE_EVICTION_POLICY=allkeys-lru

# Cache TTL for specific components (seconds)
CACHE_TTL_REPORTS=600        # 10 minutes
CACHE_TTL_ORGANISMS=300      # 5 minutes
CACHE_TTL_SEARCH=180         # 3 minutes
CACHE_TTL_STATISTICS=1800    # 30 minutes

# ============================================================================
# Rate Limiting Configuration
# ============================================================================
RATE_LIMITING_ENABLED=true
RATE_LIMITING_STORAGE=redis

# Default rate limits (requests per time window)
RATE_LIMIT_DEFAULT=100        # Default: 100 requests
RATE_WINDOW_DEFAULT=60        # Default: per minute

# Endpoint-specific rate limits
RATE_LIMIT_AUTH=5             # Auth: 5 per hour
RATE_WINDOW_AUTH=3600
RATE_LIMIT_UPLOAD=10          # Upload: 10 per hour
RATE_WINDOW_UPLOAD=3600
RATE_LIMIT_SEARCH=30          # Search: 30 per minute
RATE_WINDOW_SEARCH=60
RATE_LIMIT_READ=100           # Read: 100 per minute
RATE_WINDOW_READ=60

# ============================================================================
# Database Configuration
# ============================================================================
# Connection String (modify for your setup)
DATABASE_URL=postgresql://avalanche:password@localhost:5432/avalanche_edna

# Or use components
DB_TYPE=postgresql
DB_HOST=localhost
DB_PORT=5432
DB_NAME=avalanche_edna
DB_USER=avalanche
DB_PASSWORD=avalanche_dev_password

# Connection Pool Settings
DB_POOL_SIZE=20              # Base connection pool size
DB_POOL_MAX_OVERFLOW=40      # Additional connections when pool is full
DB_POOL_TIMEOUT=30           # Seconds to wait for connection
DB_POOL_RECYCLE=3600         # Recycle connections after 1 hour
DB_POOL_PRE_PING=true        # Test connections before use

# Query Optimization
DB_STATEMENT_TIMEOUT=300000  # 5 minutes in milliseconds
DB_IDLE_TIMEOUT=600000       # 10 minutes in milliseconds

# ============================================================================
# Application Server (Gunicorn)
# ============================================================================
GUNICORN_WORKERS=9           # (CPU cores Ã— 2) + 1
GUNICORN_WORKER_CLASS=sync   # or 'gevent' for async
GUNICORN_TIMEOUT=300         # 5 minutes
GUNICORN_KEEPALIVE=5         # Keep-alive seconds
GUNICORN_MAX_REQUESTS=10000  # Restart workers after N requests
GUNICORN_MAX_REQUESTS_JITTER=1000

# Logging
GUNICORN_ACCESS_LOG=-        # stdout
GUNICORN_ERROR_LOG=-         # stdout
GUNICORN_LOG_LEVEL=info

# ============================================================================
# Monitoring Configuration
# ============================================================================
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=8000
METRICS_ENABLED=true

# ============================================================================
# Environment
# ============================================================================
ENVIRONMENT=production       # production, development, or testing
DEBUG=false
LOG_LEVEL=INFO

# ============================================================================
# Security
# ============================================================================
SECRET_KEY=change-this-to-a-random-secret-key
ALLOWED_HOSTS=localhost,127.0.0.1

# ============================================================================
# Application Settings
# ============================================================================
APP_TYPE=streamlit           # streamlit or api
API_HOST=0.0.0.0
API_PORT=8000

# ============================================================================
# Celery (Task Queue)
# ============================================================================
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/0
CELERY_TASK_SERIALIZER=json
CELERY_ACCEPT_CONTENT=json
CELERY_RESULT_SERIALIZER=json
CELERY_TIMEZONE=UTC

# ============================================================================
# Load Testing
# ============================================================================
LOCUST_USERS=100             # Concurrent users for load testing
LOCUST_SPAWN_RATE=10         # Users spawned per second
LOCUST_RUN_TIME=300          # Test duration in seconds
